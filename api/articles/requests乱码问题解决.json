{"title":"python中requests使用中文乱码的解决方案","uid":"8a288770ed82450aa993ccbeacfd0367","slug":"requests乱码问题解决","date":"2021-12-02T15:30:02.000Z","updated":"2022-04-03T06:07:01.852Z","comments":true,"path":"api/articles/requests乱码问题解决.json","keywords":null,"cover":null,"content":"<ul>\n<li> 中文乱码处理<pre class=\"line-numbers language-none\"><code class=\"language-none\">import requests\n\nurl &#x3D; &quot;http:&#x2F;&#x2F;www.baidu.com&quot;\nr &#x3D; requests.get(url)\n# 自动选择合适的编码方式\nr.encoding &#x3D; r.apparent_encoding\nprint(r.text)</code></pre>\n中文乱码显示正常了！！</li>\n</ul>\n<p>有时候，我们还会遇到通过这个操作后无法解决的情况，比如新浪首页的表现：<br>出现这种情况，据说是使用gzip将网页压缩了，必须先对其解码，使用r.content会自动解码：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">import requests\n\nurl &#x3D; &quot;http:&#x2F;&#x2F;www.sina.com.cn&#x2F;&quot;\nr &#x3D; requests.get(url)\n# 指定编码解码方式\nhtml &#x3D; r.content.decode(&#39;UTF-8&#39;)\n# r.encoding &#x3D; &#39;utf-8&#39;</code></pre>\n<p>其实吧，处理的方式有很多，大家注意一点，那就是看请求的html数据中最前面对的charset设置的是啥！！</p>\n<ul>\n<li><p> html实体编码解析</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">In [1]: s &#x3D; &#39;目前玩的挺好的，就&amp;hellip;&amp;hellip;&lt;br&gt;给四星是因为为什么不是同一个服的就不能进社团😬😬😬😬😬😬😬😬😬😬😬😬😬😬😬😬😬😬😬&#39;\n#可以看到，有个&#39;&amp;hellip;&#39;，这玩意是html实体表示省略号&#39;...&#39;，因此需要进行处理！\nIn [2]: import html\n\nIn [3]: html.unescape(s)\nOut[3]: &#39;目前玩的挺好的，就……&lt;br&gt;给四星是因为为什么不是同一个服的就不能进社团😬😬😬😬😬😬😬😬😬😬😬😬😬😬😬😬😬😬😬&#39;</code></pre></li>\n<li><p>也是一种情况吧~</p>\n</li>\n</ul>\n<p><a class=\"link\"   href=\"https://www.cnblogs.com/xieqiankun/p/lxmlencoding.html\" >https://www.cnblogs.com/xieqiankun/p/lxmlencoding.html<i class=\"fas fa-external-link-alt\"></i></a></p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">显然这应该是编码的问题，在使用:\netree.HTML(r)\n处理源文件的时候，由于没有指定编码，所以它使用了一个默认编码，从而导致和UTF-8冲突，产生乱码。\n\n经过查阅lxml.etree.HTML的文档，我发现etree.HTML有一个参数是parser,这个参数不是必须的，因此省略以后它就会自动使用一个默认的parser。既然如此，那我手动指定一个：\ncontentTree &#x3D; etree.HTML(r, parser&#x3D;etree.HTMLParser(encoding&#x3D;&#39;utf-8&#39;))\n这里我指定了etree.HTMLParser来作为一个parser,同时，etree.HTMLParser可以接受编码作为参数。于是我指定为UTF-8。</code></pre>\n\n<pre class=\"line-numbers language-powershell\" data-language=\"powershell\"><code class=\"language-powershell\">import requests\nfrom lxml import etree\nimport sys\nreload(sys)\nsys.setdefaultencoding(&quot;utf-8&quot;)\n\nr &#x3D; requests.get(url&#x3D;&#39;http:&#x2F;&#x2F;sports.sina.cn&#x2F;nba&#x2F;rockets&#x2F;2015-10-07&#x2F;detail-ifximrxn8235561.d.html?vt&#x3D;4&amp;pos&#x3D;10&#39;)# 最基本的GET请求\nr.encoding &#x3D; &#39;utf-8&#39;\nr &#x3D; r.content\nprint r</code></pre>","text":" 中文乱码处理import requests url &#x3D; &quot;http:&#x2F;&#x2F;www.baidu.com&quot; r &#x3D; requests.get(url) # 自动选择合适的编码方式 r.encoding &#x3D; r.ap...","link":"","photos":[],"count_time":{"symbolsCount":"1.7k","symbolsTime":"2 mins."},"categories":[],"tags":[{"name":"数据分析","slug":"数据分析","count":18,"path":"api/tags/数据分析.json"}],"toc":"","author":{"name":"弦好想断","slug":"blog-author","avatar":"https://zhang18340082962.github.io/static/img/avater.jpg","link":"/","description":"处女座男生，热爱技术、吉他、旅行。","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"python办公自动化：操作excel","uid":"7df2c9f61f81e14813ba612502b886c1","slug":"python办公自动化：操作excel","date":"2021-12-08T14:28:43.000Z","updated":"2022-04-03T06:09:41.283Z","comments":true,"path":"api/articles/python办公自动化：操作excel.json","keywords":null,"cover":null,"text":"#python 使用 openpyxl 操作 excel openpyxl 最好用的 python 操作 excel 表格库，不接受反驳（想反驳自己去学其他的） openpyxl 官网链接：https://openpyxl.readthedocs.io/en/stable/ ht...","link":"","photos":[],"count_time":{"symbolsCount":"10k","symbolsTime":"9 mins."},"categories":[],"tags":[{"name":"自动化","slug":"自动化","count":4,"path":"api/tags/自动化.json"}],"author":{"name":"弦好想断","slug":"blog-author","avatar":"https://zhang18340082962.github.io/static/img/avater.jpg","link":"/","description":"处女座男生，热爱技术、吉他、旅行。","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"Python数据分析 :pandas数据读取、预处理、筛选、计算，时间序列、透视、拼接、导出","uid":"74df2b30e38d008e4f87b397961dd215","slug":"Python数据分析：pandas数据读取、预处理、筛选、计算，时间序列、透视、拼接、导出","date":"2021-10-04T06:02:22.000Z","updated":"2022-04-03T06:07:50.214Z","comments":true,"path":"api/articles/Python数据分析：pandas数据读取、预处理、筛选、计算，时间序列、透视、拼接、导出.json","keywords":null,"cover":null,"text":"一、Pandas数据结构S1&#x3D;pd.Series([‘a’,’b’,’c’]) series是一组数据与一组索引（行索引）组成的数据结构 S1&#x3D;pd.Series([‘a’,’b’,’c’],index&#x3D;(1,3,4)) 指定索引 S1&#x3D;p...","link":"","photos":[],"count_time":{"symbolsCount":"22k","symbolsTime":"20 mins."},"categories":[],"tags":[{"name":"数据分析","slug":"数据分析","count":18,"path":"api/tags/数据分析.json"}],"author":{"name":"弦好想断","slug":"blog-author","avatar":"https://zhang18340082962.github.io/static/img/avater.jpg","link":"/","description":"处女座男生，热爱技术、吉他、旅行。","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}