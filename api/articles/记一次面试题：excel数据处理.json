{"title":"记一次面试题：excel数据处理","uid":"a602a3ffbe3a3d828d4555b8d6284dc6","slug":"记一次面试题：excel数据处理","date":"2019-03-19T08:43:39.000Z","updated":"2022-04-03T06:08:27.928Z","comments":true,"path":"api/articles/记一次面试题：excel数据处理.json","keywords":null,"cover":null,"content":"<p>Sales表：</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://cdn.jsdelivr.net/gh/zhang18340082962/image-rick@master/image-rick/%E5%9B%BE%E7%89%87.42u5kgldrn0g.png\"\n                     \n                ></p>\n<p>Institution表：</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://cdn.jsdelivr.net/gh/zhang18340082962/image-rick@master/image-rick/%E5%9B%BE%E7%89%87.hsivqtazg0o.png\"\n                     \n                ></p>\n<p>Product表：</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://cdn.jsdelivr.net/gh/zhang18340082962/image-rick@master/image-rick/%E5%9B%BE%E7%89%87.57axgsalziio.png\"\n                     \n                ></p>\n<p>Price表：</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://cdn.jsdelivr.net/gh/zhang18340082962/image-rick@master/image-rick/%E5%9B%BE%E7%89%87.3hfa2v3xoukg.png\"\n                     \n                ></p>\n<p>Question：求各省份2017全年销售金额(全部产品)Top1的医院；(请保留计算过程)</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">import pandas as pd\nimport openpyxl \npath &#x3D; r&#39;C:\\Users\\supermanzwg\\Desktop\\Excel能力测试解答.xlsx&#39;\ndf &#x3D; pd.read_excel(path,sheet_name&#x3D; &#39;Sales&#39;)\ndf &#x3D; df[pd.to_datetime(df.SalesDate,format&#x3D;&#39;%Y-%m-%d&#39;).dt.year&#x3D;&#x3D;2017]\ndf2 &#x3D; pd.read_excel(path,sheet_name&#x3D; &#39;Institution&#39;)\n# print(df2.info())\n#检查并发现两表之间连接键出现不一致\nfor i in range(len(df)):\n    if df.loc[i,&#39;InstitutionCode&#39;]&#x3D;&#x3D; &#39;F6302 &#39;:\n        df.loc[i,&#39;InstitutionCode&#39;] &#x3D; &#39;F6302&#39;\n    else:\n        pass\ndf_12 &#x3D; pd.merge(df,df2,on&#x3D;&#39;InstitutionCode&#39;,how&#x3D;&#39;left&#39;)\n# print(df_12.info())\n# a &#x3D; df_12[df_12.Province.isnull()] 检查是否还存在缺失值\n# a.InstitutionCode.unique()\ndf4 &#x3D; pd.read_excel(path,sheet_name&#x3D; &#39;Price&#39;)\ndf4 &#x3D; df4[pd.to_datetime(df4.EffectiveDate,format&#x3D;&#39;%Y-%m-%d&#39;).dt.year&#x3D;&#x3D;2017]\ndf4 &#x3D; df4.drop_duplicates([&#39;SKU&#39;])#删去重复SKU值\nddff &#x3D; pd.merge(df_12,df4,on&#x3D;&#39;SKU&#39;)\nddff[&#39;money&#39;] &#x3D; ddff[&#39;Quantity&#39;]*ddff[&#39;Price&#39;]\n# print(ddff.money.sum())#销售额总和\ngroupby_ddff &#x3D; ddff.groupby([&#39;Province&#39;,&#39;InstitutionName&#39;])[&#39;money&#39;].sum().reset_index()\ngroupby_ddff[&#39;group_sort&#39;]&#x3D;groupby_ddff[&#39;money&#39;].groupby(groupby_ddff[&#39;Province&#39;]).rank(ascending&#x3D;False,method&#x3D;&#39;first&#39;)\ngroupby_ddff_top1 &#x3D; groupby_ddff[groupby_ddff[&#39;group_sort&#39;]&#x3D;&#x3D;1]\ngroupby_ddff_top1</code></pre>\n<p>写入到原excel</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\"># import xlwings as xw\nbook &#x3D; openpyxl.load_workbook(path)   #读取你要写入的workbook\n#和pd.read_excel() 用于将Dataframe写入excel。xls用xlwt。xlsx用openpyxl\nwriter &#x3D; pd.ExcelWriter(path, engine&#x3D;&#39;openpyxl&#39;)   \n##此时的writer里还只是读写器. 然后将上面读取的book复制给writer  \nwriter.book &#x3D; book\n#转化为字典的形式\nwriter.sheets &#x3D; dict((ws.title, ws) for ws in book.worksheets)\n#将data写入writer\ngroupby_ddff_top1.to_excel(writer,sheet_name&#x3D;&quot;Answer_Python&quot;,index&#x3D;False)\nwriter.save()</code></pre>\n\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://cdn.jsdelivr.net/gh/zhang18340082962/image-rick@master/image-rick/%E5%9B%BE%E7%89%87.6qq9z1446rs.png\"\n                     \n                ></p>\n","text":"Sales表： Institution表： Product表： Price表： Question：求各省份2017全年销售金额(全部产品)Top1的医院；(请保留计算过程) import pandas as pd import openpyxl path &#x3D; r&#39...","link":"","photos":[],"count_time":{"symbolsCount":"2.1k","symbolsTime":"2 mins."},"categories":[],"tags":[{"name":"数据分析","slug":"数据分析","count":18,"path":"api/tags/数据分析.json"}],"toc":"","author":{"name":"弦好想断","slug":"blog-author","avatar":"D:\\blog\\public\\avatar.jpg","link":"/","description":"处女座男生，热爱技术、吉他、旅行。","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"python面向对象习题","uid":"1eac341c429c84a40e6d901f88df1212","slug":"python面向对象习题","date":"2019-07-19T04:59:17.000Z","updated":"2022-04-03T06:08:04.656Z","comments":true,"path":"api/articles/python面向对象习题.json","keywords":null,"cover":null,"text":"写完对对象这个东西了解很多了 # coding&#x3D;utf-8 &quot;&quot;&quot; 一：定义一个学生类。有下面的类属性： 1 姓名 2 年龄 3 成绩（语文，数学，英语)[每课成绩的类型为整数] 类方法： 1 获取学生的姓名：get_name() 返回类型...","link":"","photos":[],"count_time":{"symbolsCount":"7.1k","symbolsTime":"6 mins."},"categories":[],"tags":[{"name":"数据分析","slug":"数据分析","count":18,"path":"api/tags/数据分析.json"}],"author":{"name":"弦好想断","slug":"blog-author","avatar":"D:\\blog\\public\\avatar.jpg","link":"/","description":"处女座男生，热爱技术、吉他、旅行。","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"大学三年，写给那个迟到的人","uid":"cf1675b4714191423290b7ca7c89a04a","slug":"大学三年，写给那个迟到的人","date":"2018-11-19T08:28:23.000Z","updated":"2021-12-19T09:26:42.492Z","comments":true,"path":"api/articles/大学三年，写给那个迟到的人.json","keywords":null,"cover":null,"text":"亲爱的X姑娘： 你好！给你写这封信的时候，我正在学校的机电楼B301上第一节课。看了简书里好多给异性朋友写信的文章，我也心血来潮，忍不住想要和你说说话了。 —1— 早上醒的很早，在床上平躺到闹铃声响起，依旧照常的起床，洗漱，整理好出门。 没有胃口，不太想吃饭。但想到将来要在你面前...","link":"","photos":[],"count_time":{"symbolsCount":"2.1k","symbolsTime":"2 mins."},"categories":[],"tags":[{"name":"成长，旧时光","slug":"成长，旧时光","count":4,"path":"api/tags/成长，旧时光.json"}],"author":{"name":"弦好想断","slug":"blog-author","avatar":"D:\\blog\\public\\avatar.jpg","link":"/","description":"处女座男生，热爱技术、吉他、旅行。","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}